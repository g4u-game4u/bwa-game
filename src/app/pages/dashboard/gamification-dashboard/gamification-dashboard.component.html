<div class="gamification-dashboard" [class.sidebar-collapsed]="sidebarCollapsed" full role="main" aria-label="Painel de Gamificação">
  <!-- Screen reader announcements -->
  <div aria-live="polite" aria-atomic="true" class="sr-only" id="dashboard-announcements">
    {{ screenReaderAnnouncement }}
  </div>

  <!-- Skip link for keyboard navigation -->
  <a href="#main-content" class="skip-link">
    Pular para o conteúdo principal
  </a>

  <!-- Left Sidebar -->
  <aside class="dashboard-sidebar" [class.collapsed]="sidebarCollapsed" role="complementary" aria-label="Informações do jogador">
    <c4u-card class="sidebar-card">
      <div class="sidebar-content">
        <!-- Season Level -->
        <div class="sidebar-section">
          <c4u-season-level
            *ngIf="playerStatus"
            [level]="playerStatus.seasonLevel"
            [playerName]="playerStatus.name"
            [metadata]="playerStatus.metadata">
          </c4u-season-level>
          
          <c4u-shimmer *ngIf="isLoadingPlayer && !playerStatus"></c4u-shimmer>
        </div>
        
        <!-- Point Wallet -->
        <div class="sidebar-section">
          <c4u-point-wallet
            *ngIf="pointWallet"
            [points]="pointWallet">
          </c4u-point-wallet>
          
          <c4u-shimmer *ngIf="isLoadingPlayer && !pointWallet"></c4u-shimmer>
        </div>
        
        <!-- Season Progress -->
        <div class="sidebar-section">
          <c4u-season-progress
            *ngIf="seasonProgress"
            [progress]="seasonProgress">
          </c4u-season-progress>
          
          <c4u-shimmer *ngIf="isLoadingPlayer && !seasonProgress"></c4u-shimmer>
        </div>
      </div>
    </c4u-card>
    
    <!-- Sidebar Toggle Button - Outside the card -->
    <button class="sidebar-toggle" (click)="toggleSidebar()" [attr.aria-label]="sidebarCollapsed ? 'Expandir menu' : 'Recolher menu'">
      <i class="icon-arrow_forward_ios" [class.invert]="!sidebarCollapsed"></i>
    </button>
  </aside>
  
  <!-- Main Content Area -->
  <main class="dashboard-main" id="main-content">
    <!-- Header with Month Selector centered -->
    <div class="dashboard-header" role="banner">
      <div class="header-spacer"></div>
      <c4u-seletor-mes (onSelectedMonth)="onMonthChange($event)"></c4u-seletor-mes>
      <button 
        class="refresh-button"
        (click)="refreshData()"
        [disabled]="isLoading"
        [attr.aria-label]="isLoading ? 'Atualizando dados...' : 'Atualizar dados do painel'"
        title="Atualizar dados">
        <i class="ri-refresh-line" [class.spinning]="isLoading" aria-hidden="true"></i>
        <span class="refresh-time" *ngIf="lastRefreshTime">{{ formattedRefreshTime }}</span>
      </button>
    </div>
    
    <!-- KPI Section -->
    <section class="dashboard-section" aria-labelledby="kpi-section-title">
      <h2 id="kpi-section-title" class="section-title">Minha Carteira</h2>
      
      <div class="kpi-grid" *ngIf="playerKPIs.length > 0" role="group" aria-labelledby="kpi-section-title">
        <c4u-kpi-circular-progress
          *ngFor="let kpi of playerKPIs; let i = index; trackBy: trackByKpiId"
          [label]="kpi.label"
          [current]="kpi.current"
          [target]="kpi.target"
          [colorIndex]="i">
        </c4u-kpi-circular-progress>
      </div>
      
      <div class="kpi-grid" *ngIf="isLoadingKPIs">
        <c4u-shimmer></c4u-shimmer>
        <c4u-shimmer></c4u-shimmer>
        <c4u-shimmer></c4u-shimmer>
      </div>
    </section>
    
    <!-- Progress Section -->
    <section class="dashboard-section" aria-labelledby="progress-section-title">
      <h2 id="progress-section-title" class="section-title">Meu Progresso</h2>
      
      <c4u-activity-progress
        *ngIf="activityMetrics && macroMetrics"
        [activities]="activityMetrics"
        [macros]="macroMetrics">
      </c4u-activity-progress>
      
      <c4u-shimmer *ngIf="isLoadingProgress"></c4u-shimmer>
    </section>
    
    <!-- Company Portfolio Section -->
    <section class="dashboard-section carteira-section" aria-labelledby="company-section-title">
      <h2 id="company-section-title" class="section-title">Carteira</h2>
      
      <c4u-card class="carteira-card">
        <c4u-company-table
          *ngIf="companies.length > 0"
          [companies]="companies"
          (companySelected)="onCompanySelected($event)">
        </c4u-company-table>
        
        <c4u-shimmer *ngIf="isLoadingCompanies"></c4u-shimmer>
        
        <div *ngIf="!isLoadingCompanies && companies.length === 0" class="empty-state">
          <p>Nenhuma empresa encontrada na carteira</p>
        </div>
      </c4u-card>
    </section>
  </main>
  
  <!-- Company Detail Modal -->
  <modal-company-detail
    *ngIf="selectedCompany"
    [company]="selectedCompany">
  </modal-company-detail>
</div>
