<div class="gamification-dashboard" full role="main" aria-label="Painel de Gamificação">
  <!-- Screen reader announcements -->
  <div aria-live="polite" aria-atomic="true" class="sr-only" id="dashboard-announcements">
    {{ screenReaderAnnouncement }}
  </div>

  <!-- Skip link for keyboard navigation -->
  <a href="#main-content" class="skip-link">
    Pular para o conteúdo principal
  </a>

  <!-- Left Sidebar -->
  <aside class="dashboard-sidebar" role="complementary" aria-label="Informações do jogador">
    <div class="sidebar-content">
      <!-- Season Level -->
      <div class="sidebar-section">
        <c4u-season-level
          *ngIf="playerStatus"
          [level]="playerStatus.seasonLevel"
          [playerName]="playerStatus.name"
          [metadata]="playerStatus.metadata">
        </c4u-season-level>
        
        <c4u-shimmer *ngIf="isLoadingPlayer && !playerStatus"></c4u-shimmer>
        
        <div class="missing-data" *ngIf="!isLoadingPlayer && !playerStatus">
          <span class="missing-data-text">Faltam dados</span>
        </div>
      </div>
      
      <!-- Point Wallet -->
      <div class="sidebar-section">
        <c4u-point-wallet
          *ngIf="pointWallet"
          [points]="pointWallet">
        </c4u-point-wallet>
        
        <c4u-shimmer *ngIf="isLoadingPlayer && !pointWallet"></c4u-shimmer>
        
        <div class="missing-data" *ngIf="!isLoadingPlayer && !pointWallet">
          <span class="missing-data-text">Faltam dados</span>
        </div>
      </div>
      
      <!-- Season Progress -->
      <div class="sidebar-section">
        <c4u-season-progress
          *ngIf="seasonProgress"
          [progress]="seasonProgress">
        </c4u-season-progress>
        
        <c4u-shimmer *ngIf="isLoadingPlayer && !seasonProgress"></c4u-shimmer>
        
        <div class="missing-data" *ngIf="!isLoadingPlayer && !seasonProgress">
          <span class="missing-data-text">Faltam dados</span>
        </div>
      </div>
    </div>
  </aside>
  
  <!-- Main Content Area -->
  <main class="dashboard-main" id="main-content">
    <!-- Header with Month Selector and Refresh -->
    <div class="dashboard-header" role="banner">
      <c4u-seletor-mes
        (onSelectedMonth)="onMonthChange($event)">
      </c4u-seletor-mes>
      
      <button 
        class="refresh-button"
        (click)="refreshData()"
        [disabled]="isLoading"
        [attr.aria-label]="isLoading ? 'Atualizando dados...' : 'Atualizar dados do painel'"
        title="Atualizar dados">
        <i class="ri-refresh-line" [class.spinning]="isLoading" aria-hidden="true"></i>
        <span class="refresh-time" *ngIf="lastRefreshTime" [attr.aria-label]="'Última atualização: ' + formattedRefreshTime">{{ formattedRefreshTime }}</span>
      </button>
    </div>
    
    <!-- KPI Section -->
    <section class="dashboard-section" aria-labelledby="kpi-section-title">
      <h2 id="kpi-section-title" class="section-title">Minha Carteira</h2>
      
      <div class="kpi-grid" *ngIf="playerKPIs.length > 0" role="group" aria-labelledby="kpi-section-title">
        <c4u-kpi-circular-progress
          *ngFor="let kpi of playerKPIs; trackBy: trackByKpiId"
          [label]="kpi.label"
          [current]="kpi.current"
          [target]="kpi.target"
          [attr.aria-label]="kpi.label + ': ' + kpi.current + ' de ' + kpi.target">
        </c4u-kpi-circular-progress>
      </div>
      
      <div class="kpi-grid" *ngIf="isLoadingKPIs">
        <c4u-shimmer></c4u-shimmer>
        <c4u-shimmer></c4u-shimmer>
        <c4u-shimmer></c4u-shimmer>
      </div>
      
      <div class="missing-data" *ngIf="!isLoadingKPIs && playerKPIs.length === 0">
        <span class="missing-data-text">Faltam dados</span>
      </div>
    </section>
    
    <!-- Progress Section -->
    <section class="dashboard-section" aria-labelledby="progress-section-title">
      <h2 id="progress-section-title" class="section-title">Meu Progresso</h2>
      
      <c4u-activity-progress
        *ngIf="activityMetrics && macroMetrics"
        [activities]="activityMetrics"
        [macros]="macroMetrics">
      </c4u-activity-progress>
      
      <c4u-shimmer *ngIf="isLoadingProgress"></c4u-shimmer>
      
      <div class="missing-data" *ngIf="!isLoadingProgress && (!activityMetrics || !macroMetrics)">
        <span class="missing-data-text">Faltam dados</span>
      </div>
    </section>
    
    <!-- Company Portfolio Section -->
    <section class="dashboard-section" aria-labelledby="company-section-title">
      <h2 id="company-section-title" class="section-title">Carteira</h2>
      
      <c4u-company-table
        *ngIf="companies.length > 0"
        [companies]="companies"
        (companySelected)="onCompanySelected($event)">
      </c4u-company-table>
      
      <c4u-shimmer *ngIf="isLoadingCompanies"></c4u-shimmer>
      
      <div class="missing-data" *ngIf="!isLoadingCompanies && companies.length === 0">
        <span class="missing-data-text">Faltam dados</span>
      </div>
    </section>
  </main>
  
  <!-- Company Detail Modal -->
  <modal-company-detail
    *ngIf="selectedCompany"
    [company]="selectedCompany">
  </modal-company-detail>
</div>
